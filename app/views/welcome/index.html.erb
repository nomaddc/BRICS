<%= javascript_tag do %>
     google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawSeriesChart);

    function drawSeriesChart() {

      var data = google.visualization.arrayToDataTable($('.temp_information').data('temp'));

      var options = {
        title: 'Карты многомерного шкалирования совместной встречаемости' +
               'ключевых слов по всему информационному массиву?????',
        bubble: {textStyle: {fontSize: 11}}
      };

      var chart = new google.visualization.BubbleChart(document.getElementById('series_chart_div'));
      chart.draw(data, options);
    }
<% end %>

<div class="container-fluid">

  <div class="row">
    <div class="col-6"><h1>Welcome to BRICS database!</h1></div>
  </div>
  <div class="row">
    <div class="col-6"><h3><%= link_to 'Go to Database', controller: 'articles' %></h3></div>
  </div>
  <div class="row">
    <div class="col-6">
      <%= form_tag articles_path, :enforce_utf8 => false, :method => 'get', :class => 'form-inline'  do %>
        <div class="form-group">
          <h5>Search Database:</h5>
          <%= text_field_tag :search, params[:search], class: 'form-control input-sm' %>
        </div>
        <div class="form-group">
          <%= submit_tag "Search", :name => nil, class: 'btn btn-primary btn-sm' %>
        </div>
      <% end %>
    </div>
  </div>



  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Home</a>
      <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Eng</a>
      <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Rus</a>
    </div>
  </nav>


  <div class="tab-content" id="nav-tabContent">

    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">

      <div class="row">
        <div class="col-12">
	      <%= form_tag root_path, :enforce_utf8 => false, :method => 'get' do  %>
            <h4>Build a graph:</h4>
            <%= text_field_tag :search2, params[:search2], id: "keywords", data: { role: 'tagsinput'} %>
            <%= javascript_tag do %>
              TagsInput('#keywords', "<%= root_url %>keywords.json")
            <% end %>
	        <%= submit_tag :Submit, class: 'btn btn-primary btn-sm' %>
	      <% end %>
	      <h5><%= @keywordslst %></h5>
          <br>

          <%= content_tag :div, class: "temp_information", data: {temp: @graph} do %><% end %>
        </div>
      </div>
      <div class="row">
        <div class="col-12"><div id="series_chart_div" style="width: 100%; height: 800px;"></div></div>
      </div>
  
    </div>
    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">

      <h4>Total texts in Bulletin</h4>
	  <%= line_chart @articles.where(:lang => 'eng').group_by_month(:date, last: 6).count.map { |x,y| { x => (@sume += y)}}.reduce({}, :merge), curve: false %>
      <h4>Texts spread by subject (monthly slice)</h4>
	  <%= column_chart @articles.where(:lang => 'eng').group(:category).order('category desc').group_by_month(:date, last: 6).count, colors: ["violet", "blue", "green", "yellow", "orange", "red"], stacked: true %>
      <h4>Total Bulletin entries by category (total)</h4>
	  <%= pie_chart @articles.where(:lang => 'eng').group(:category).count, colors: ["red", "orange", "yellow", "green", "blue", "violet"], legend: "right" %>
      
    </div>
    <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">

      <div class="row">
        <div class="col-12"><h4>Количество текстов, помещённых в Бюллетень</h4></div>
      </div>
      <div class="row">
        <div class="col-12"><%= line_chart @articles.where(:lang => 'rus').group_by_month(:date, last: 6).count.map { |x,y| { x => (@sumr += y)}}.reduce({}, :merge) %></div>
      </div>
      <div class="row">
        <div class="col-12"><h4>Распределение текстов по тематическим разделам (месячный разрез)</h4></div>
        <div class="col-12"><%= column_chart @articles.where(:lang => 'rus').group(:category).order('category desc').group_by_month(:date, last: 6).count, colors: ["violet", "blue", "green", "yellow", "orange", "red"], stacked: true %></div>
      </div>
      <div class="row">
        <div class="col-12"><h4>Количество текстов по тематическим разделам Бюллетеня (всего)</h4></div>
	    <div class="col-12"><%= pie_chart @articles.where(:lang => 'rus').group(:category).count, colors: ["red", "orange", "yellow", "green", "blue", "violet"], legend: "right" %></div>
      </div>
  
    </div>

  </div>
</div>